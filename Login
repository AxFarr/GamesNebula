from tkinter import *
import tkinter.messagebox as tm
import sqlite3
from Popup import *
import Users
import re


db = sqlite3.connect("game nebula.db")
c = db.cursor()


class LoginFrame(Frame):
    def __init__(self, master):
        Frame.__init__(self, master)

        self.master = master
        self.logUI()

    def logUI(self):

            self.master.title("Login")
            self.pack(fill=BOTH, expand=True)

            frame1 = Frame(self)
            frame1.pack(fill=X)

            self.label_1 = Label(frame1, text="Username", width=7)
            self.label_1.pack(side=LEFT, padx=5, pady=5)

            self.entry_1 = Entry(frame1)
            self.entry_1.pack(side=LEFT, padx=5)

            frame2 = Frame(self)
            frame2.pack(fill=X)

            self.label_2 = Label(frame2, text="Password", width=7)
            self.label_2.pack(side=LEFT, padx=5, pady=5)

            self.entry_2 = Entry(frame2, show="*")
            self.entry_2.pack(side=LEFT, padx=5)

            frame3 = Frame(self)
            frame3.pack(fill=X)

            self.logbtn = Button(self, text="Login", fg='green', command = self._login_btn_clicked)
            self.logbtn.pack(padx=5, pady=2)
            self.regbtn = Button(self, text="Register", command=self._register_btn_clicked)
            self.regbtn.pack(padx=5, pady=2)


    def _login_btn_clicked(self):
        username = self.entry_1.get()
        password = self.entry_2.get()


        if len(self.entry_1.get()) == 0 or len(self.entry_2.get()) == 0 :
            print("Null Entry")
        else:

            def CheckUserExists(username, password):
                if c.execute("SELECT password FROM UserData WHERE name = ? AND password = ?",  (username, password)):
                   data = c.fetchall()
                   if not data:
                       return False
                   else:
                       return True



            if CheckUserExists(username, password) is True:
                print("Login Complete. Welcome " + username + "!")
                import Main
                Main.root.deiconify()
            else:
                print("Username or password is incorrect")

    def _register_btn_clicked(self):
        import Registration
        Registration.root.deiconify()


root = Tk()
def on_closing():
    sys.exit()
root.protocol("WM_DELETE_WINDOW", on_closing)
ft = LoginFrame(master=root)
root.mainloop()
